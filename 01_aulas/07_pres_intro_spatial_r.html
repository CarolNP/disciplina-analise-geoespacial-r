<!DOCTYPE html>
<html lang="" xml:lang="">
  <head>
    <title>Introdução à análise geoespacial com R    </title>
    <meta charset="utf-8" />
    <meta name="author" content="Maurício H. Vancine   Milton C. Ribeiro" />
    <script src="libs/header-attrs/header-attrs.js"></script>
    <link href="libs/remark-css/metropolis.css" rel="stylesheet" />
    <link href="libs/remark-css/metropolis-fonts.css" rel="stylesheet" />
    <link href="libs/font-awesome/css/fontawesome-all.min.css" rel="stylesheet" />
  </head>
  <body>
    <textarea id="source">
class: center, middle, inverse, title-slide

# Introdução à análise geoespacial com R <br><br><br>
## 7 Estrutura e manejo de dados matriciais <br><br><br>
### Maurício H. Vancine <br> Milton C. Ribeiro
### 23/10/2020

---




class: clear
background-image: url(img/geo_raster_wd.png)
background-size: 800px

---

background-image: url(img/r_spatial.jpeg)
background-size: 350px
background-position: 80% 65%

# 7 Estrutura e manejo de dados raster

## Tópicos
1. Pacote raster
1. Classes raster
1. Importar dados matriciais
1. Descrição de objetos raster
1. Converter CRS
1. Manejo de dados
1. Operação geométricas
1. Operação espaciais
1. Interações raster-vetor
1. Conversões raster-vetor
1. Exportar dados matriciais

---

# 7 Estrutura e manejo de dados raster

## Script

&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;

## .center[`script_aula_07.R`]

---

background-image: url(img/geo_raster_plot.png)
background-size: 800px
background-position: 50% 100%

# 7.1 Raster: pacote raster

## Pacote raster

```r
# raster
install.packages("raster")
library(raster)
```

&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;

[*] https://rspatial.org/raster/

---

background-image: url(img/geo_raster_plot.png)
background-size: 800px
background-position: 50% 100%

# 7.1 Raster: pacote raster

## Pacote terra

```r
# raster
install.packages("terra")
library(terra)
```

&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;

[*] https://rspatial.org/terra/

---

background-image: url(img/geo_raster_stars.png)
background-size: 500px
background-position: 50% 70%

# 7.1 Raster: pacote raster

## Pacote stars

```r
# raster
install.packages("stars")
library(stars)
```

&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;

[*] https://r-spatial.github.io/stars/

---

# 7.2 Importar dados matriciais

## download raster

```r
# directory
setwd("/home/mude/data/github/disciplina-geoprocessamento/03_dados/02_raster")

# download
download.file(url = "http://biogeo.ucdavis.edu/data/worldclim/v2.0/tif/base/wc2.0_10m_bio.zip",
              destfile = "wc2.0_10m_bio.zip")

# unzip
unzip("wc2.0_10m_bio.zip")
```

---

# 7.2 Importar dados matriciais
## import raster

```r
# pacote
library(raster)

# diretorio
setwd("/home/mude/data/github/disciplina-geoprocessamento/03_dados/02_raster")

# import raster
ra &lt;- raster::raster("wc2.0_bio_10m_01.tif")
ra

# map
raster::plot(ra)
```

---

# 7.2 Importar dados matriciais
## import raster

```r
# pacote
library(raster)

# diretorio
setwd("/home/mude/data/github/disciplina-geoprocessamento/03_dados/02_raster")

# import raster
ra &lt;- raster::raster("wc2.0_bio_10m_01.tif")
ra

# map
raster::plot(ra)
```

---

background-image: url(https://geocompr.robinlovelace.net/figures/raster-intro-plot2-1.png)
background-size: 300px
background-position: 50% 70%

# 7.3 Tipos de dados matriciais

---

background-image: url(https://www.neonscience.org/sites/default/files/images/dc-spatial-raster/single_multi_raster.png)
background-size: 300px
background-position: 50% 70%

# 7.3 Tipos de dados matriciais

---

# 7.2 Importar dados matriciais
## import raster

```r
# listar arquivos
fi &lt;- dir(pattern = ".tif")
fi
```



---

# 7.2 Importar dados matriciais
## import raster


```r
# import raster
st &lt;- raster::stack(fi)
st
```



---

# 7.2 Importar dados matriciais
## import raster


```r
# map
raster::plot(st)
```

---

# 7.2 Importar dados matriciais
## import raster




---

# 7.4 Estrutura de dados matriciais
### Número de linhas

```r
nrow(ra)
```

--

### Número de colunas

```r
ncol(ra)
```

### Número de linhas

```r
ncell(ra)
```

---

# 7.4 Estrutura de dados matriciais
### Resolução

```r
# resolucao
res(ra)
```

--

### Extenção

```r
extent(ra)
```

--

### Projeção

```r
# projecao
projection(ra)
```

---

# 7.4 Estrutura de dados matriciais
### names

```r
# names
names(ra)
```

--

### Valores

```r
values(ra)
```

---

# 8.16 Manipulando dados matriciais
## Seleção de raster

```r
# map
raster::plot(st[[1:5]])
```

---

# 8.16 Manipulando dados matriciais
## Seleção de raster

```r
# map
raster::plot(st$wc2.0_bio_10m_01 )
```

---

# 8.16 Manipulando dados matriciais
## Álgebra de raster

```r
# calculadora de raster
ra_15 &lt;- ra &gt; 15
ra_15
```

--


```r
# map
raster::plot(ra_15)
```

---

# 8.16 Manipulando dados matriciais
## Álgebra de raster

```r
# calculadora de raster
ra2 &lt;- ra * ra
ra2
```

--


```r
# map
raster::plot(ra2)
```

---

# 8.17 Operação geométricas de dados matriciais
## Agregação e desagregação

```r
# resolution
res(ra)
```

--


```r
# aggregation - aumenta o tamanho do raster
ra_03 &lt;- aggregate(ra, fact = 2)
ra_03

# new resolution
res(ra_03)[1]
```

--


```r
# desagregacao - diminiu o tamanho do raster
ra_01 &lt;- disaggregate(ra_03, fact = 3)
ra_01

# new resolution
res(ra_01)[1]
```

---

# 8.18 Operação espaciais de dados matriciais
### Extração pela máscara

```r
# crop - adjust extention
ra_crop &lt;- raster::crop(ra, rec_bairros_union)
ra_crop

plot(ra_crop)
```


```r
# crop - adjust extention
ra_crop &lt;- raster::crop(ra, rec_bairros_union)
ra_crop

plot(ra_crop)
```


---

# 8.18 Operação espaciais de dados matriciais
### Extração pela máscara

```r
# mask
ra_mask &lt;- mask(ra_crop, rec_bairros_union)
ra_mask

plot(ra_mask)
```

---

# 8.18 Operação espaciais de dados matriciais
### Extração de valores para pontos

```r
# mask
po_ext &lt;- raster::extract(ra_mask, rec_bairros_rp)
po_ext

hist(po_ext)
```

---

# 8.19 Vetor para raster: pacote fasterize

## vetor para raster 

```r
# pacote
# install.packages("fasterize")
library(fasterize)
```

--


```r
# criar um raster
ra_fast &lt;- fasterize::raster(rec_bairros, res = 90)
ra_fast
```

--


```r
rec_uso_raster &lt;- fasterize::fasterize(sf = rec_bairros, ra_fast)
rec_uso_raster
```

---

# 8.20 Reprojeção e exportar dados matriciais
# Reprojeção

```r
ra_mask_utm &lt;- raster::projectRaster(ra_mask, CRS = 31965)
ra_mask_utm

plot(ra_mask_utm)
```

---

# 8.20 Reprojeção e exportar dados matriciais
# Exportar

```r
setwd("/home/mude/data/github/disciplina-geoprocessamento/03_dados/02_raster")

raster::writeRaster(ra_mask_utm, "ra_mask_utm.tif")
```

---

class: inverse, middle, center

# Dúvidas?

---

class: clear, middle

## Maurício Vancine

&lt;br&gt;

Contatos:

&lt;br&gt;
<i class="fas  fa-envelope " style="color:#0000ee;"></i> [mauricio.vancine@gmail.com]()
&lt;br&gt;
<i class="fab  fa-twitter " style="color:#0000ee;"></i> [@mauriciovancine](https://twitter.com/mauriciovancine)
&lt;br&gt;
<i class="fab  fa-github " style="color:#0000ee;"></i> [mauriciovancine](https://mauriciovancine.netlify.com/)
&lt;br&gt;
<i class="fas  fa-link " style="color:#0000ee;"></i> [mauriciovancine.netlify.com](https://mauriciovancine.netlify.com/)

Slides criados via pacote [xaringan](https://github.com/yihui/xaringan) e tema [Metropolis](https://github.com/pat-s/xaringan-metropolis)
    </textarea>
<style data-target="print-only">@media screen {.remark-slide-container{display:block;}.remark-slide-scaler{box-shadow:none;}}</style>
<script src="https://remarkjs.com/downloads/remark-latest.min.js"></script>
<script>var slideshow = remark.create({
"highlightStyle": "rainbow",
"highlightLines": true,
"countIncrementalSlides": false
});
if (window.HTMLWidgets) slideshow.on('afterShowSlide', function (slide) {
  window.dispatchEvent(new Event('resize'));
});
(function(d) {
  var s = d.createElement("style"), r = d.querySelector(".remark-slide-scaler");
  if (!r) return;
  s.type = "text/css"; s.innerHTML = "@page {size: " + r.style.width + " " + r.style.height +"; }";
  d.head.appendChild(s);
})(document);

(function(d) {
  var el = d.getElementsByClassName("remark-slides-area");
  if (!el) return;
  var slide, slides = slideshow.getSlides(), els = el[0].children;
  for (var i = 1; i < slides.length; i++) {
    slide = slides[i];
    if (slide.properties.continued === "true" || slide.properties.count === "false") {
      els[i - 1].className += ' has-continuation';
    }
  }
  var s = d.createElement("style");
  s.type = "text/css"; s.innerHTML = "@media print { .has-continuation { display: none; } }";
  d.head.appendChild(s);
})(document);
// delete the temporary CSS (for displaying all slides initially) when the user
// starts to view slides
(function() {
  var deleted = false;
  slideshow.on('beforeShowSlide', function(slide) {
    if (deleted) return;
    var sheets = document.styleSheets, node;
    for (var i = 0; i < sheets.length; i++) {
      node = sheets[i].ownerNode;
      if (node.dataset["target"] !== "print-only") continue;
      node.parentNode.removeChild(node);
    }
    deleted = true;
  });
})();
(function() {
  "use strict"
  // Replace <script> tags in slides area to make them executable
  var scripts = document.querySelectorAll(
    '.remark-slides-area .remark-slide-container script'
  );
  if (!scripts.length) return;
  for (var i = 0; i < scripts.length; i++) {
    var s = document.createElement('script');
    var code = document.createTextNode(scripts[i].textContent);
    s.appendChild(code);
    var scriptAttrs = scripts[i].attributes;
    for (var j = 0; j < scriptAttrs.length; j++) {
      s.setAttribute(scriptAttrs[j].name, scriptAttrs[j].value);
    }
    scripts[i].parentElement.replaceChild(s, scripts[i]);
  }
})();
(function() {
  var links = document.getElementsByTagName('a');
  for (var i = 0; i < links.length; i++) {
    if (/^(https?:)?\/\//.test(links[i].getAttribute('href'))) {
      links[i].target = '_blank';
    }
  }
})();
// adds .remark-code-has-line-highlighted class to <pre> parent elements
// of code chunks containing highlighted lines with class .remark-code-line-highlighted
(function(d) {
  const hlines = d.querySelectorAll('.remark-code-line-highlighted');
  const preParents = [];
  const findPreParent = function(line, p = 0) {
    if (p > 1) return null; // traverse up no further than grandparent
    const el = line.parentElement;
    return el.tagName === "PRE" ? el : findPreParent(el, ++p);
  };

  for (let line of hlines) {
    let pre = findPreParent(line);
    if (pre && !preParents.includes(pre)) preParents.push(pre);
  }
  preParents.forEach(p => p.classList.add("remark-code-has-line-highlighted"));
})(document);</script>

<script>
slideshow._releaseMath = function(el) {
  var i, text, code, codes = el.getElementsByTagName('code');
  for (i = 0; i < codes.length;) {
    code = codes[i];
    if (code.parentNode.tagName !== 'PRE' && code.childElementCount === 0) {
      text = code.textContent;
      if (/^\\\((.|\s)+\\\)$/.test(text) || /^\\\[(.|\s)+\\\]$/.test(text) ||
          /^\$\$(.|\s)+\$\$$/.test(text) ||
          /^\\begin\{([^}]+)\}(.|\s)+\\end\{[^}]+\}$/.test(text)) {
        code.outerHTML = code.innerHTML;  // remove <code></code>
        continue;
      }
    }
    i++;
  }
};
slideshow._releaseMath(document);
</script>
<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
(function () {
  var script = document.createElement('script');
  script.type = 'text/javascript';
  script.src  = 'https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML';
  if (location.protocol !== 'file:' && /^https?:/.test(script.src))
    script.src  = script.src.replace(/^https?:/, '');
  document.getElementsByTagName('head')[0].appendChild(script);
})();
</script>
  </body>
</html>
