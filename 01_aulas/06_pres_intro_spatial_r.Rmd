---
title: "Introdução à análise geoespacial com R <br><br><br>"
subtitle: "6 Estrutura e manejo de dados vetoriais <br><br><br>"
author: "Maurício H. Vancine <br> Milton C. Ribeiro"
date: "22/10/2020"
output:
  xaringan::moon_reader:
    css: [metropolis, metropolis-fonts]
    lib_dir: libs
    nature:
      highlightStyle: rainbow
      highlightLines: true
      countIncrementalSlides: false
---

```{r,setup, include=FALSE}
options(htmltools.dir.version = FALSE, encoding = "UTF-8")
knitr::opts_chunk$set(warning = FALSE, message = FALSE)
```

class: clear
background-image: url(img/geo_sf.png)
background-size: 800px

---

background-image: url(img/r_spatial.jpeg)
background-size: 350px
background-position: 90% 85%

# 6 Estrutura e manejo de dados vetoriais

## Tópicos
1. Material para análise de dados geoespacias
1. Vetor: pacote sf
1. Importar dados vetoriais
1. Tipos de dados vetoriais
1. Estrutura de dados vetoriais
1. Projeção de dados vetoriais
1. Tabela de atributos
1. Operações de atributos de dados vetoriais
1. Operações geométricas de dados vetoriais
1. Operações espaciais de dados vetoriais
1. Exportar dados vetoriais

---

background-image: url(img/cover_analise_espacial_r.jpg)
background-size: 250px
background-position: 50% 65%

# 6.1 Material

## Livros

### **Análise espacial com R (2019)**

<br><br><br><br><br><br><br><br><br><br><br><br>

[*] https://www.dropbox.com/s/blgtp2bmpdghol7/AnaliseEspacialComR.pdf?dl=0

---

background-image: url(img/cover_geocompr.png)
background-size: 230px
background-position: 50% 65%

# 6.1 Material

## Livros

### **Geocomputation with R (2019)**

<br><br><br><br><br><br><br><br><br><br><br><br>

[*] https://geocompr.robinlovelace.net/

---

background-image: url(img/cover_intro_r_spatial_2ed.jpg)
background-size: 230px
background-position: 50% 65%

# 6.1 Material

## Livros

### **An introduction to R for spatial analysis & mapping (2019)**

<br><br><br><br><br><br><br><br><br><br><br><br>

[*] https://bookdown.org/lexcomber/brunsdoncomber2e/

---

background-image: url(img/cover_remote_sensing_and_gis.jpg)
background-size: 230px
background-position: 50% 60%

# 6.1 Material

## Livros

### **Remote Sensing and GIS for Ecologists (2016)**

<br><br><br><br><br><br><br><br><br><br><br><br>

[*] http://book.ecosens.org/rsebook/

---

background-image: url(img/cover_introduction_spatial_data_analysis.jpg)
background-size: 230px
background-position: 50% 60%

# 6.1 Material

## Livros

### **An Introduction to Spatial Data Analysis (2020)**

<br><br><br><br><br><br><br><br><br><br><br><br>

[*] http://book.ecosens.org/gsbook/

---

background-image: url(img/cover_geospatial_health_data.jpg)
background-size: 220px
background-position: 50% 60%

# 6.1 Material

## Livros

### **Geospatial Health Data**

<br><br><br><br><br><br><br><br><br><br><br><br>

[*] https://www.paulamoraga.com/book-geospatial/

---

background-image: url(img/cover_data_visualization_with_r.png)
background-size: 230px
background-position: 50% 65%

# 6.1 Material

## Livros

### **Data Visualization with R (2019)**

<br><br><br><br><br><br><br><br><br><br><br><br>

[*] https://keen-swartz-3146c4.netlify.com/

---

background-image: url(img/cover_fundamentals_of_data_visualization.png)
background-size: 230px
background-position: 50% 65%

# 6.1 Material

## Livros

### **Fundamentals of data visualization (2019)**

<br><br><br><br><br><br><br><br><br><br><br><br>

[*] https://keen-swartz-3146c4.netlify.com/

---

background-image: url(img/person_edzer_pebesma.jpg)
background-size: 230px
background-position: 50% 65%

# 6.1 Material

## Livros

### **Spatial Data Science (2019) - Edzer Pebesma**

<br><br><br><br><br><br><br><br><br><br><br><br>

[*] https://keen-swartz-3146c4.netlify.com/

---

background-image: url(img/cover_intro_gis.png)
background-size: 280px
background-position: 50% 75%

# 6.1 Material

## Apostilas

### **Introduction to GIS: Manipulating and Mapping Geospatial Data in R (2019)**

<br><br><br><br><br><br><br><br><br><br><br>

[*] https://cdn2.hubspot.net/hubfs/2287011/Atlan%20GIS%20Course/All%20lessons.pdf
---

background-image: url(img/person_robert_hijmans.jpg)
background-size: 230px
background-position: 50% 70%

# 6.1 Material

## Site

### **Spatial Data Analysis and Modeling with R (2020)**

<br><br><br><br><br><br><br><br><br><br><br><br>

[*] http://rspatial.org

---

background-image: url(img/package_sf.gif)
background-size: 300px
background-position: 50% 70%

# 6.2 Vetor: pacote sf

## Pacote sf

```{r eval=FALSE}
# sf
install.packages("sf")
library(sf)
```

<br><br><br><br><br><br><br><br><br><br><br>

[*] https://journal.r-project.org/archive/2018/RJ-2018-009/RJ-2018-009.pdf

---

# 6.2 Vetor: pacote sf

## **Pacote sf**

### **Rápida importação e exportação** de dados

--

### **Desempenho aprimorado** de mapas e gráficos

--

### Objetos `sf` podem ser tratados como `data frames` (`tibbles`) na maioria das **operações de manejo**

--

### As funções `sf` **podem ser combinadas** usando o operador `%>%` e funcionam bem com `tidyverse`

--

### Os nomes das funções sf são relativamente **consistentes e intuitivos** (todos começam com `st_`)

---

class: inverse, center, middle

# Vamos começar fazendo o download de um vetor pelo R

---

# 6.3 Importar dados vetoriais

## Download

### Criar um diretório 
```{r eval=FALSE}
# create a diretorio
dir.create(here::here("03_dados", "vetor"))
```

--

### Download de **pontos de nascentes** para Rio Claro/SP
```{r eval=FALSE}
# download
for(i in c(".dbf", ".prj", ".shp", ".shx")){
  download.file(url = paste0("http://geo.fbds.org.br/SP/RIO_CLARO/HIDROGRAFIA/SP_3543907_NASCENTES", i),
              destfile = here::here("03_dados", "vetor", paste0("SP_3543907_NASCENTES", i)), mode = "wb")
}
```

---

# 6.3 Importar dados vetoriais

## Download

### Download de **linhas da hidrografia** para Rio Claro/SP
```{r eval=FALSE}
# download
for(i in c(".dbf", ".prj", ".shp", ".shx")){
  download.file(url = paste0("http://geo.fbds.org.br/SP/RIO_CLARO/HIDROGRAFIA/SP_3543907_RIOS_SIMPLES", i),
              destfile = here::here("03_dados", "vetor", paste0("SP_3543907_RIOS_SIMPLES", i)), mode = "wb")
}
```

### Download de **polígonos de cobertura da terra** para Rio Claro/SP
```{r eval=FALSE}
# download
for(i in c(".dbf", ".prj", ".shp", ".shx")){
  download.file(url = paste0("http://geo.fbds.org.br/SP/RIO_CLARO/USO/SP_3543907_USO", i),
              destfile = here::here("03_dados", "vetor", paste0("SP_3543907_USO", i)), mode = "wb")
}
```

---

# 6.3 Importar dados vetoriais

## Dados preexistentes
```{r eval=FALSE}
# import
rc_use <- sf::st_read(here::here("03_dados", "vetor", "SP_3543907_USO.shp"))
```

---

# 6.3 Importar dados vetoriais

## Dados preexistentes
```{r eval=FALSE}
# view
rc_use
```

---

# 6.3 Importar dados vetoriais

## Dados preexistentes - visualizar
```{r eval=FALSE, warning=FALSE, message=FALSE, fig.align='center', out.width='50%'}
plot(rc_use[1], col = "gray", main = NA)
```

---

background-image: url(img/package_geobr02.png)
background-size: 300px
background-position: 50% 70%

# 6.3 Importar dados vetoriais

## Dados de pacotes: geobr
```{r eval=FALSE}
install.packages("geobr")
library(geobr)
```

<br><br><br><br><br><br><br><br><br><br><br>

[*] https://github.com/ipeaGIT/geobr

---

# 6.3 Importar dados vetoriais

## Dados de pacotes: geobr
```{r message=FALSE, warning=FALSE}
# brazil
br_2019 <- geobr::read_country(year = 2019)
br_2019
```

---

# 6.3 Importar dados vetoriais

## Dados de pacotes: geobr
```{r fig.align='center', out.width='50%'}
# plot
plot(br_2019[1], col = "gray", main = NA)
```

---

# 6.3 Importar dados vetoriais

## Dados de pacotes: geobr
```{r}
# brazil
br_1872 <- geobr::read_country(year = 1872)
br_1872
```

---

# 6.3 Importar dados vetoriais

## Dados de pacotes: geobr

```{r fig.align='center', out.width='50%'}
# plot
plot(br_1872[1], col = "gray", main = NA)
```

---

# 6.3 Importar dados vetoriais

## Dados de pacotes: geobr
```{r}
# sao paulo
sp_2019 <- geobr::read_state(code_state = "SP", year = 2019)
sp_2019
```

---

# 6.3 Importar dados vetoriais

## Dados de pacotes: geobr
```{r fig.align='center', out.width='50%'}
# plot
plot(sp_2019[1], col = "gray", main = NA)
```

---

# 6.3 Importar dados vetoriais

## Dados de pacotes: geobr
```{r}
# pernambuco municipios
sp_mun_2019 <- geobr::read_municipality(code_muni = "SP", year = 2019)
sp_mun_2019
```

---

# 6.3 Importar dados vetoriais

## Dados de pacotes: geobr
```{r fig.align='center', out.width='50%'}
# plot
plot(sp_mun_2019[1], col = "gray", main = NA)
```

---

# 6.3 Importar dados vetoriais

## Dados de pacotes: geobr

<br><br>

|Function|Geographies available|Years available|Source|
|-----|-----|-----|-----|
|`read_country()`| Country | 1872, 1900, 1911, 1920, 1933, 1940, 1950, 1960, 1970, 1980, 1991, 2000, 2001, 2010, 2013, 2014, 2015, 2016, 2017, 2018 | IBGE |
|`read_state()`| States | 1872, 1900, 1911, 1920, 1933, 1940, 1950, 1960, 1970, 1980, 1991, 2000, 2001, 2010, 2013, 2014, 2015, 2016, 2017, 2018 | IBGE |
|`read_municipality()`| Municipality | 1872, 1900, 1911, 1920, 1933, 1940, 1950, 1960, 1970, 1980, 1991, 2000, 2001, 2005, 2007, 2010, 2013, 2014, 2015, 2016, 2017, 2018 | IBGE | 

---

background-image: url(img/package_ropensci.png)
background-size: 650px
background-position: 50% 50%

# 6.3 Importar dados vetoriais

## Dados de pacotes: rnaturalearth
```{r eval=FALSE}
install.packages("rnaturalearth")
library(rnaturalearth)
```

<br><br><br><br><br><br><br><br><br><br>

[*] http://www.naturalearthdata.com/ 

[*] https://docs.ropensci.org/rnaturalearth/

---

# 6.3 Importar dados vetoriais

## Dados de pacotes: rnaturalearth
```{r}
# america do sul
sa <- rnaturalearth::ne_countries(scale = "small", continent = "South America", returnclass = "sf")
sa
```

---

# 6.3 Importar dados vetoriais

## Dados de pacotes: rnaturalearth
```{r fig.align='center', out.width='40%'}
# plot
plot(sa[1], col = "gray", main = NA)
```

---

# 6.3 Importar dados vetoriais

## Dados de pacotes: rnaturalearth
```{r}
# america do sul
coastline <- rnaturalearth::ne_coastline(scale = "small", returnclass = "sf")
coastline
```

---

# 6.3 Importar dados vetoriais

## Dados de pacotes: rnaturalearth
```{r fig.align='center', out.width='50%'}
# plot
plot(coastline[1], col = "blue", main = NA)
```

---

# 6.3 Importar dados vetoriais

## Dados de uma planilha .csv
```{r,message=FALSE}
library(tidyverse)

# diretorio
setwd("/home/mude/data/github/disciplina-geoprocessamento/03_dados/00_tabelas")

# importar tabela
si <- readr::read_csv("ATLANTIC_AMPHIBIANS_sites.csv")
```

---

class: inverse, middle, center

# Dúvidas?

---

class: clear, middle

## Maurício Vancine

<br>

Contatos:

`r icon::fa_envelope(colour = "#0000ee")` [mauricio.vancine@gmail.com]()
<br>
`r icon::fa_twitter(colour = "#0000ee")` [@mauriciovancine](https://twitter.com/mauriciovancine)
<br>
`r icon::fa_github(colour = "#0000ee")` [mauriciovancine](https://mauriciovancine.netlify.com/)
<br>
`r icon::fa_link(colour = "#0000ee")` [mauriciovancine.netlify.com](https://mauriciovancine.netlify.com/)

Slides criados via pacote [xaringan](https://github.com/yihui/xaringan) e tema [Metropolis](https://github.com/pat-s/xaringan-metropolis)