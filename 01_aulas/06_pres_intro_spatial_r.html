<!DOCTYPE html>
<html lang="" xml:lang="">
  <head>
    <title>Introdução à análise geoespacial com R    </title>
    <meta charset="utf-8" />
    <meta name="author" content="Maurício H. Vancine   Milton C. Ribeiro" />
    <script src="libs/header-attrs/header-attrs.js"></script>
    <link href="libs/remark-css/metropolis.css" rel="stylesheet" />
    <link href="libs/remark-css/metropolis-fonts.css" rel="stylesheet" />
    <link href="libs/font-awesome/css/fontawesome-all.min.css" rel="stylesheet" />
  </head>
  <body>
    <textarea id="source">
class: center, middle, inverse, title-slide

# Introdução à análise geoespacial com R <br><br><br>
## 6 Estrutura e manejo de dados vetoriais <br><br><br>
### Maurício H. Vancine <br> Milton C. Ribeiro
### 22/10/2020

---




class: clear
background-image: url(img/geo_vector_sf_allison.png)
background-size: 800px

---

background-image: url(img/r_spatial.jpeg)
background-size: 350px
background-position: 80% 65%

# 6 Estrutura e manejo de dados vetoriais

## Tópicos
1. Pacotes
1. Geometrias sf
1. Classes sf
1. Importar dados vetoriais
1. Descrição de objetos sf
1. Converter dados para sf
1. Converter CRS
1. Tabela de atributos
1. Operações de atributos
1. Operações espaciais
1. Operações geométricas
1. Exportar dados vetoriais

---

# 6 Estrutura e manejo de dados vetoriais

## Script

&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;

## .center[`script_aula_06.R`]

---

background-image: url(img/geo_sp_dep.png)
background-size: 700px
background-position: 50% 65%

# 6.1 Pacotes

## Pacote sp


```r
# sp
install.packages("sp")
library(sp)
```

&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;

[*] https://github.com/edzer/sp/

---

background-image: url(img/package_sf.gif)
background-size: 350px
background-position: 50% 70%

# 6.1 Pacotes

## Pacote sf


```r
# sf
install.packages("sf")
library(sf)
```

&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;

[*] https://r-spatial.github.io/sf/

---

background-image: url(img/cheatsheet_sf.png)
background-size: 500px
background-position: 50% 60%

# 6.1 Pacotes

## Pacote sf

### Cheatsheets

&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;

[*] https://raw.githubusercontent.com/rstudio/cheatsheets/master/sf.pdf

---

background-image: url(img/geo_sf_article.png)
background-size: 500px
background-position: 50% 85%

# 6.1 Pacotes

## Pacote sf

### Artigo
&gt; - Pebesma, Edzer. ["Simple Features for R: Standardized Support for Spatial Vector Data."](https://journal.r-project.org/archive/2018/RJ-2018-009/) The R Journal 10.01 (2018): 439-446.

---

background-image: url(img/geo_sf_deps.png)
background-size: 700px
background-position: 50% 85%

# 6.1 Pacotes

## Pacote sf

### Dependências de outros pacotes

---

background-image: url(img/geo_sf_methods.png)
background-size: 600px
background-position: 50% 80%

# 6.1 Pacotes

## Pacote sf

### Métodos

---

background-image: url(img/geo_sf_functions.png)
background-size: 700px
background-position: 50% 70%

# 6.1 Pacotes

## Pacote sf

### Funções

---

# 6.1 Pacotes

## Pacote sf

### **Rápida importação e exportação** de dados

--

### **Desempenho aprimorado** de mapas e gráficos

--

### Objetos `sf` podem ser tratados como `data frames` (`tibbles`) na maioria das **operações de manejo**

--

### As funções `sf` **podem ser combinadas** usando o operador `%&gt;%` e funcionam bem com `tidyverse`

--

### Os nomes das funções sf são relativamente **consistentes e intuitivos** (todos começam com `sf::st_`)

---

background-image: url(img/geo_vector_data.png)
background-size: 500px
background-position: 45% 80%

# 6.2 Tipos de geometrias sf

## Tipos de dados geoespaciais vetoriais

---

background-image: url(img/geo_vector_sf_types.png)
background-size: 500px
background-position: 50% 80%

# 6.2 Tipos de geometrias sf

## Tipos de geometrias

---

# 6.3 Classes sf

## Simple feature geometries (sfg)

### A classe `sfg` representa os **diferentes tipos de geometrias** no R: ponto, linha, polígono (e seus equivalentes ‘multi’) ou coleção de geometrias

--

#### Funções para criar geometrias da classe `sfg`:


```r
# simple
sf::st_point()
sf::st_linestring()
sf::st_polygon()

# multi
sf::st_multipoint()
sf::st_multilinestring()
sf::st_multipolygon()

# collections
sf::st_geometrycollection()
```

---

# 6.3 Classes sf

## Simple feature geometries (sfg)

### Os objetos `sfg` podem ser **criados** a partir de **três tipos de dados R base**:

&lt;br&gt;

### 1. **vetor numérico**: um único ponto
### 2. **matriz**: um conjunto de pontos, onde cada linha representa um ponto, um multiponto ou uma linha
### 3. **lista**: uma coleção de objetos como matrizes, cadeias multilinha ou coleções de geometrias

---

# 6.3 Classes sf

## Simple feature geometries (sfg)


```r
# vector - point
vec &lt;- c(5, 2)
po &lt;- sf::st_point(vec)
po
```


```r
# plot
plot(po, pch = 20, cex = 4, axes = TRUE, graticule = TRUE)
```

---

# 6.3 Classes sf

## Simple feature geometries (sfg)


```r
# matrix - multipoint
multipoint_matrix = rbind(c(5, 2), c(1, 3), c(3, 4), c(3, 2))
po_mul &lt;- sf::st_multipoint(multipoint_matrix)
po_mul
```


```r
# plot
plot(po_mul, pch = 20, cex = 4, axes = TRUE, graticule = TRUE)
```

---

# 6.3 Classes sf

## Simple feature geometries (sfg)


```r
# matrix - multipoint
multipoint_matrix = rbind(c(5, 2), c(1, 3), c(3, 4), c(3, 2))
lin &lt;- sf::st_linestring(multipoint_matrix)
lin
```


```r
# plot
plot(lin, lwd = 2, axes = TRUE, graticule = TRUE)
```

---

# 6.3 Classes sf

## Simple feature geometries (sfg)


```r
# list - polygon
polygon_list = list(rbind(c(1, 5), c(2, 2), c(4, 1), c(4, 4), c(1, 5)))
pol &lt;- sf::st_polygon(polygon_list)
pol
```


```r
# plot
plot(pol, col = "gray", axes = TRUE, graticule = TRUE)
```

---

# 6.3 Classes sf

## Simple feature columns (sfc)

### Uma **lista de objetos** `sfg` que possui o **mesmo CSR** (*Coordinate Reference System*)

--

### Pode conter objetos da **mesma geometria** ou de **geometrias diferentes**

--

### Funções para **criar** a classe `sfc` e verificar o **tipo da geometria e CRS**:

```r
sf::st_sfc()
sf::st_geometry_type()
sf::st_crs()
```

---

# 6.3 Classes sf

## Simple feature columns (sfc)

```r
# sfc POINT
point1 &lt;- sf::st_point(c(5, 2))
point2 &lt;- sf::st_point(c(1, 3))
points_sfc &lt;- sf::st_sfc(point1, point2)
points_sfc
```


```r
sf::st_geometry_type(points_sfc)
```

---

# 6.3 Classes sf

## Simple feature columns (sfc)

```r
# plot
plot(points_sfc, pch = 20, cex = 4, axes = TRUE, graticule = TRUE)
```

---

# 6.3 Classes sf

## Simple feature columns (sfc)

```r
# sfc GEOMETRY
po_pol_sfc &lt;- sf::st_sfc(po, pol)
po_pol_sfc
```


```r
sf::st_geometry_type(po_pol_sfc)
```

---

# 6.3 Classes sf

## Simple feature columns (sfc)

```r
# plot
plot(po_pol_sfc, pch = 20, cex = 4, lwd = 2, col = "gray", axes = TRUE, graticule = TRUE)
```

---

# 6.3 Classes sf

## Simple feature columns (sfc)

### Coordinate Reference Systems (CRS) - EPSG

```r
# EPSG definition
points_sfc_wgs &lt;- sf::st_sfc(point1, point2, crs = 4326)
sf::st_crs(points_sfc_wgs)
```

---

# 6.3 Classes sf

## Simple feature columns (sfc)

### Coordinate Reference Systems (CRS) - proj4string

```r
# EPSG definition
points_sfc_wgs &lt;- sf::st_sfc(point1, point2, crs = "+proj=longlat +datum=WGS84 +no_defs")
sf::st_crs(points_sfc_wgs)
```

---

# 6.3 Classes sf

## Simple feature columns (sfc)

```r
# plot
plot(points_sfc_wgs, pch = 20, cex = 4, axes = TRUE, graticule = TRUE)
```

---

# 6.3 Classes sf

## A classe sf

### A classe sf (simple features) são *data.frames* com **atributos espaciais** armazenados em uma coluna, geralmente chamada de **geometry** 

--

### Essa **dualidade** é central para o conceito de **simple features**: na maioria das vezes, um sf pode **ser tratado e se comporta** como um *data.frame *

--

### **Simple features** são, em essência, *data.frames* com uma **extensão espacial**

---

# 6.3 Classes sf

## A classe sf

### Criar um objeto sf

```r
rc_point &lt;- sf::st_point(c(-47.57,-22.39))         # sfg object
rc_geom &lt;- sf::st_sfc(rc_point, crs = 4326)        # sfc object
rc_attrib &lt;- data.frame(                       # data.frame object
  name = "Rio Claro",
  temperature = 19,
  date = as.Date("2020-10-13")
)
rc_sf &lt;- sf::st_sf(rc_attrib, geometry = rc_geom)  # sf object
```

---

# 6.3 Classes sf

## A classe sf

### A estrutura de um objeto sf

```r
rc_sf
```

### As duas classes do objeto sf

```r
class(rc_sf)
```

---

# 6.3 Classes sf

## A classe sf

```r
# plot
plot(rc_sf[1], pch = 20, cex = 4, axes = TRUE, graticule = TRUE) # rc_sf[1] - plotar a primeira coluna
```

---

# 6.3 Classes sf

## A classe sf

```r
# plot
plot(rc_sf[2], pch = 20, cex = 4, axes = TRUE, graticule = TRUE) # rc_sf[2] - plotar a segunda coluna
```

---

# 6.3 Classes sf

## A classe sf

```r
# plot
plot(rc_sf$geometry, pch = 20, cex = 4, axes = TRUE, graticule = TRUE) # rc_sf$geometry - plotar apenas a geometria
```

---

class: inverse, center, middle

# Dúvidas?

---

class: inverse, center, middle

# Vamos começar fazendo o download de vetores pelo R

---

# 6.4 Importar dados

## Download

### Criar um diretório 

```r
# create a diretorio
dir.create(here::here("03_dados", "vetor"))
```

--

### Download de **pontos de nascentes** para Rio Claro/SP

```r
# download
for(i in c(".dbf", ".prj", ".shp", ".shx")){
  download.file(url = paste0("http://geo.fbds.org.br/SP/RIO_CLARO/HIDROGRAFIA/SP_3543907_NASCENTES", i),
                destfile = here::here("03_dados", "vetor", paste0("SP_3543907_NASCENTES", i)), mode = "wb")
}
```

---

# 6.4 Importar dados

## Download

### Download de **linhas da hidrografia** para Rio Claro/SP

```r
# download
for(i in c(".dbf", ".prj", ".shp", ".shx")){
  download.file(url = paste0("http://geo.fbds.org.br/SP/RIO_CLARO/HIDROGRAFIA/SP_3543907_RIOS_SIMPLES", i),
                destfile = here::here("03_dados", "vetor", paste0("SP_3543907_RIOS_SIMPLES", i)), mode = "wb")
}
```

### Download de **polígonos de cobertura da terra** para Rio Claro/SP

```r
# download
for(i in c(".dbf", ".prj", ".shp", ".shx")){
  download.file(url = paste0("http://geo.fbds.org.br/SP/RIO_CLARO/USO/SP_3543907_USO", i),
                destfile = here::here("03_dados", "vetor", paste0("SP_3543907_USO", i)), mode = "wb")
}
```

---

class: inverse, center, middle

# Importar dados preexistentes

---

# 6.4 Importar dados

## Dados preexistentes

```r
# import
rc_spr &lt;- sf::st_read(here::here("03_dados", "vetor", "SP_3543907_NASCENTES.shp"), quiet = TRUE)
rc_spr
```

---

# 6.4 Importar dados

## Dados preexistentes

```r
# plot
plot(rc_spr$geometry, pch = 20, col = "blue", main = NA, axes = TRUE, graticule = TRUE)
```

---

# 6.4 Importar dados

## Dados preexistentes

```r
# import
rc_riv &lt;- sf::st_read(here::here("03_dados", "vetor", "SP_3543907_RIOS_SIMPLES.shp"), quiet = TRUE)
rc_riv
```

---

# 6.4 Importar dados

## Dados preexistentes

```r
# plot
plot(rc_riv$geometry, col = "steelblue", main = NA, axes = TRUE, graticule = TRUE)
```
---

# 6.4 Importar dados

## Dados preexistentes

```r
# import
rc_use &lt;- sf::st_read(here::here("03_dados", "vetor", "SP_3543907_USO.shp"), quiet = TRUE)
rc_use
```

---

# 6.4 Importar dados

## Dados preexistentes

```r
# plot
plot(rc_use[5], col = c("blue", "orange", "gray30", "forestgreen", "green"), main = NA, axes = TRUE, graticule = TRUE)
```

---

class: inverse, center, middle

# Importar dados de GPS

---

class: inverse, center, middle

# Um agradecimento ao Rafael (Urucum), que gentilmente cedeu os dados <i class="fas  fa-grin-beam-sweat "></i>

---

# 6.4 Importar dados

## Dados de GPS (.gpx)

```r
# import gps data
gps_gpx &lt;- sf::read_sf(here::here("03_dados", "vetor", "waypoints.gpx"), layer = "waypoints")
gps_gpx
```

---

# 6.4 Importar dados

## Dados de GPS (.gpx)

```r
# plot
plot(gps_gpx$geometry, cex = 4, pch = 20, col = "red", main = NA, axes = TRUE, graticule = TRUE)
```

---

# 6.4 Importar dados

## Dados de GPS (.kml)

```r
# import gps data
gps_kml &lt;- sf::read_sf(here::here("03_dados", "vetor", "waypoints.kml"))
gps_kml
```

---

# 6.4 Importar dados

## Dados de GPS (.kml)

```r
# plot
plot(gps_kml$geometry, cex = 4, pch = 20, col = "red", main = NA, axes = TRUE, graticule = TRUE)
```

---

class: inverse, center, middle

# Importar dados de pacotes

---

background-image: url(img/package_geobr02.png)
background-size: 300px
background-position: 50% 70%

# 6.4 Importar dadosf

## Dados de pacotes: geobr

```r
install.packages("geobr")
library(geobr)
```

&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;

[*] https://github.com/ipeaGIT/geobr

---

# 6.4 Importar dados

## Dados de pacotes: geobr

```r
# brazil 2019
br_2019 &lt;- geobr::read_country(year = 2019, showProgress = FALSE)
br_2019
```

---

# 6.4 Importar dados

## Dados de pacotes: geobr

```r
# plot
plot(br_2019$geom, col = "gray", main = NA, axes = TRUE, graticule = TRUE)
```

---

# 6.4 Importar dados

## Dados de pacotes: geobr

```r
# brazil 1872
br_1872 &lt;- geobr::read_country(year = 1872, showProgress = FALSE)
br_1872
```

---

# 6.4 Importar dados

## Dados de pacotes: geobr


```r
# plot
plot(br_1872$geom, col = "gray", main = NA, axes = TRUE, graticule = TRUE)
```

---

# 6.4 Importar dados

## Dados de pacotes: geobr

```r
# sao paulo state
sp_2019 &lt;- geobr::read_state(code_state = "SP", year = 2019, showProgress = FALSE)
sp_2019
```

---

# 6.4 Importar dados

## Dados de pacotes: geobr

```r
# plot
plot(sp_2019$geom, col = "gray", main = NA, axes = TRUE, graticule = TRUE)
```

---

# 6.4 Importar dados

## Dados de pacotes: geobr

```r
# sao paulo municipalities
sp_mun_2019 &lt;- geobr::read_municipality(code_muni = "SP", year = 2019, showProgress = FALSE)
sp_mun_2019
```

---

# 6.4 Importar dados

## Dados de pacotes: geobr

```r
# plot
plot(sp_mun_2019$geom, col = "gray", main = NA, axes = TRUE, graticule = TRUE)
```

---

# 6.4 Importar dados

## Dados de pacotes: geobr

```r
# rio claro
rc_2019 &lt;- geobr::read_municipality(code_muni = 3543907, year = 2019, showProgress = FALSE)
rc_2019
```

---

# 6.4 Importar dados

## Dados de pacotes: geobr

```r
# plot
plot(rc_2019$geom, col = "gray", main = NA, axes = TRUE, graticule = TRUE)
```

---

# 6.4 Importar dados

## Dados de pacotes: geobr

```r
# biomes
bi_2019 &lt;- geobr::read_biomes(year = 2019, showProgress = FALSE)
bi_2019
```

---

# 6.4 Importar dados

## Dados de pacotes: geobr

```r
# plot
plot(bi_2019$geom, col = "gray", main = NA, axes = TRUE, graticule = TRUE)
```

---

# 6.4 Importar dados

## Dados de pacotes: geobr

&lt;br&gt;

|Function|Geographies available|Years available|Source|
|-----|-----|-----|-----|
|`read_country()`| Country | 1872, 1900, 1911, 1920, 1933, 1940, 1950, 1960, 1970, 1980, 1991, 2000, 2001, 2010, 2013, 2014, 2015, 2016, 2017, 2018, 2019 | IBGE |
|`read_state()`| States | 1872, 1900, 1911, 1920, 1933, 1940, 1950, 1960, 1970, 1980, 1991, 2000, 2001, 2010, 2013, 2014, 2015, 2016, 2017, 2018, 2019 | IBGE |
|`read_municipality()`| Municipality | 1872, 1900, 1911, 1920, 1933, 1940, 1950, 1960, 1970, 1980, 1991, 2000, 2001, 2005, 2007, 2010, 2013, 2014, 2015, 2016, 2017, 2018, 2019 | IBGE | 
|`read_biomes()`| Biomes | 2004, 2019 | IBGE | 

---

# 6.4 Importar dados

## Dados de pacotes: geobr


```r
# list all datasets available in the geobr package
geobr::list_geobr()
```

---

background-image: url(img/package_ropensci.png)
background-size: 500px
background-position: 50% 55%

# 6.4 Importar dados

## Dados de pacotes: rnaturalearth

```r
# package
install.packages("rnaturalearth")
library(rnaturalearth)
```

&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;

[*] http://www.naturalearthdata.com/ 

[*] https://docs.ropensci.org/rnaturalearth/

---

# 6.4 Importar dados

## Dados de pacotes: rnaturalearth

```r
# south america
sa &lt;- rnaturalearth::ne_countries(scale = "small", continent = "South America", returnclass = "sf")
sa
```

---

# 6.4 Importar dados

## Dados de pacotes: rnaturalearth

```r
# plot
plot(sa$geometry, col = "gray", main = NA, axes = TRUE, graticule = TRUE)
```

---

# 6.4 Importar dados

## Dados de pacotes: rnaturalearth

```r
# coast lines
coastline &lt;- rnaturalearth::ne_coastline(scale = "small", returnclass = "sf")
coastline
```

---

# 6.4 Importar dados

## Dados de pacotes: rnaturalearth

```r
# plot
plot(coastline$geometry, col = "blue", main = NA, axes = TRUE, graticule = TRUE)
```

---

class: inverse, center, middle

# Descrição de objetos sf

---

# 6.5 Descrição de objetos sf

## Informações geográficas e tabela de atributos

```r
# rio claro 2019
rc_2019
```

---

# 6.5 Descrição de objetos sf

## Informações geográficas

### Geometry type

```r
# geometry
sf::st_geometry_type(rc_2019)
```

--

### Bounding box

```r
# extention
sf::st_bbox(rc_2019)
```

--

### Coordinate reference system

```r
# coordinate reference system
sf::st_crs(rc_2019)
```

---

background-image: url(img/geo_vector_attribute_table.png)
background-size: 450px
background-position: 45% 80%

# 6.5 Descrição de objetos sf

## Tabela de atributos

### Relação entre a geometria e suas características

---

# 6.5 Descrição de objetos sf

## Tabela de atributos

### Acessar a tabela de atributos de um `sf`

```r
# acessar a tabela de atributos
sp_mun_2019_tab &lt;- sf::st_drop_geometry(sp_mun_2019)
sp_mun_2019_tab
```


```r
# classe
class(sp_mun_2019_tab)
```

---

class: inverse, center, middle

# Importar dados de planilhas eletrônicas e converter em sf

---

# 6.6 Converter dados sf

## Dados de uma planilha eletrônica

```r
# package
library(tidyverse)

# importar tabela
si &lt;- readr::read_csv(here::here("03_dados", "ATLANTIC_AMPHIBIANS_sites.csv"))
si
```

---

# 6.6 Converter dados sf

## Add as duas colunas de `lon` e `lat`

```r
# .csv para .shp
si &lt;- si %&gt;% 
  dplyr::mutate(lon = longitude, lat = latitude, .before = 1)
si
```

---

# 6.6 Converter dados sf

## Converter dados de planilhas em sf

```r
# .csv para .shp
si_ve &lt;- si %&gt;% 
  sf::st_as_sf(coords = c("lon", "lat"), crs = 4326)
si_ve
```

---

# 6.6 Converter dados sf

## Converter dados de planilhas em sf

```r
# plot
plot(si_ve$geometry, pch = 20, main = NA, axes = TRUE, graticule = TRUE)
```

---

background-image: url(img/geo_sp.png),url(img/geo_sp_dep.png)
background-size: 250px,700px
background-position: 90% 18%,50% 95%

# 6.6 Converter dados sf

## Tipos de objetos `sp`
- SpatialPoints 
- SpatialLines
- SpatialPolygons
- SpatialPointsDataFrame
- SpatialLinesDataFrame
- SpatialPolygonsDataFrame

---

# 6.6 Converter dados sf

## Dados `sp`

```r
# countries
co110_sp &lt;- rnaturalearth::countries110
co110_sp
```

---

# 6.6 Converter dados sf

## Converter `sp` para `sf`

```r
# countries
co110_sf &lt;- sf::st_as_sf(co110_sp)
co110_sf
```

---

# 6.6 Converter dados sf

## Converter `sf` para `sp`

```r
# plot
plot(co110_sf$geometry, col = "gray", main = NA, axes = TRUE, graticule = TRUE)
```

---

# 6.6 Converter dados sf

## Converter `sf` para `sp`

```r
# countries
co110_sp &lt;- sf::as_Spatial(co110_sf)
co110_sp
```

---

class: inverse, center, middle

# Conversão do CRS

---

# 6.7 Conversão do CRS

## Converter CRS local

### SIRGAS2000/UTM23S -&gt; WGS84/UTM zone 23S

```r
# convert datum
rc_2019_utm_wgs84 &lt;- sf::st_transform(rc_2019, crs = 32723)
rc_2019_utm_wgs84
```

[*] https://epsg.io/32723

---

# 6.7 Conversão do CRS

## Converter CRS local

### SIRGAS2000/UTM23S -&gt; WGS84/GCS

```r
# utm to geographic
rc_2019_gcs_wgs84 &lt;- sf::st_transform(rc_2019, crs = 4326)
rc_2019_gcs_wgs84
```

[*] https://epsg.io/4326

---

# 6.7 Conversão do CRS

## Converter CRS local

### Mapa


---

# 6.7 Conversão do CRS

## Converter CRS global

```r
# countries
co110_sf
```

---

# 6.7 Conversão do CRS

## Converter CRS global

```r
# plot
plot(co110_sf$geometry, axes = TRUE, graticule = TRUE)
```

---

# 6.7 Conversão do CRS

## Converter CRS global

### Projeção de Mollweide

```r
# mollweide projection
co110_sf_moll &lt;- sf::st_transform(co110_sf, crs = "+proj=moll")
co110_sf_moll
```

[*] https://epsg.io/54009

---

# 6.7 Conversão do CRS

## Converter CRS global

### Projeção de Mollweide

```r
# plot
plot(co110_sf_moll$geometry, graticule = TRUE)
```

---

# 6.7 Conversão do CRS

## Converter CRS global

### Projeção azimutal de Lambert

```r
# lambert projection
co110_sf_lamb &lt;- sf::st_transform(co110_sf, crs = "+proj=laea +x_0=0 +y_0=0 +lon_0=0 +lat_0=0")
co110_sf_lamb
```

---

# 6.7 Conversão do CRS

## Converter CRS global

### Projeção azimutal de Lambert

```r
# plot
plot(co110_sf_lamb$geometry, graticule = TRUE)
```

---

# 6.7 Conversão do CRS

## Converter CRS global

### Projeção azimutal de Lambert

```r
# lambert projection
co110_sf_lamb &lt;- sf::st_transform(co110_sf, crs = "+proj=laea +x_0=0 +y_0=0 +lon_0=-50 +lat_0=0")
co110_sf_lamb
```

---

# 6.7 Conversão do CRS

## Converter CRS global

### Projeção azimutal de Lambert

```r
# plot
plot(co110_sf_lamb$geometry, graticule = TRUE)
```

---

class: inverse, center, middle
# Manejo e análise de dados vetoriais

---

# Manejo e análise de dados vetoriais

## 6.9 Operações de atributos

### Modificação de objetos espaciais baseado em **informações não espaciais** associadas a dados geográficos

### Operações:
1. Subset de atributos
1. Join de atrinutos 
1. Aggregation de atributos
1. Criação de atributos
1. Outros operações

---

# Manejo e análise de dados vetoriais

## 6.10 Operações espaciais

### Modificação de objetos espaciais baseado na sua **localização e formato**

### Operações:
1. Subset espacial
1. Relações topológicas
1. Join espacial
1. Join não-sobreposta
1. Aggregation espacial
1. Relações de distância

---

# Manejo e análise de dados vetoriais

## 6.11 Operações geométricas

### Modificação de objetos espaciais baseado em operações que mudam a **geometria do vetor**

### Operações:
1. Simplificação
1. Centroides
1. Buffers
1. Transformações afins
1. Cortes
1. União
1. Transformações geométricas

---

class: inverse, center, middle

# Operações de atributos

---

# 6.9 Operações de atributos

## 1. Subset de atributos

```r
# filtro da feicao
sp_mun_2019_rc &lt;- sp_mun_2019 %&gt;% 
  dplyr::filter(name_muni == "Rio Claro")
sp_mun_2019_rc
```

---

# 6.9 Operações de atributos

## 1. Subset de atributos

```r
# plot
plot(sp_mun_2019_rc$geom, col = "gray", main = NA, axes = TRUE, graticule = TRUE)
```

---

# 6.9 Operações de atributos

## 2. Junção de atrinutos 

```r
# download
download.file(url = "ftp://ftp.ibge.gov.br/../Censos/Censo_Demografico_2010/resultados/total_populacao_sao_paulo.zip",
              destfile = here::here("03_dados", "vetor", "total_populacao_sao_paulo.zip"), mode = "wb")
```

--


```r
# unzip
unzip(here::here("03_dados", "vetor", "total_populacao_sao_paulo.zip"), exdir = here::here("03_dados", "vetor"))
```

--


```r
# import
sp_cense &lt;- readxl::read_xls(here::here("03_dados", "vetor", "total_populacao_sao_paulo.xls")) %&gt;% 
  dplyr::mutate(code_muni = as.numeric(`Código do município`))
sp_cense
```

---

# 6.9 Operações de atributos

## 2. Junção de atrinutos 

```r
sp_mun_2019_pop &lt;- dplyr::left_join(sp_mun_2019, sp_cense, by = "code_muni")
sp_mun_2019_pop
```

---

# 6.9 Operações de atributos

## 3. Aggregation de atributos

```r
sp_mun_2019_total &lt;- sp_mun_2019_pop %&gt;% 
  dplyr::group_by(name_state) %&gt;% 
  dplyr::summarise(pop = sum(`Total da população 2010`))
sp_mun_2019_total
```

---

# 6.9 Operações de atributos

## 3. Aggregation de atributos

```r
plot(sp_mun_2019_total[2], col = "gray", main = "")
```

---

# 6.9 Operações de atributos

## 4. Criação de atributos

```r
sp_mun_2019_pop_diff &lt;- sp_mun_2019_pop %&gt;% 
  dplyr::mutate(diff = `Total da população 2010` - `Total da população 2000`)
sp_mun_2019_pop_diff
```

---

# 6.9 Operações de atributos

## 4. Criação de atributos

```r
plot(sp_mun_2019_pop_diff[17], main = "")
```

---

# 6.9 Operações de atributos

## 4. Criação de atributos

```r
sp_mun_2019_area &lt;- sp_mun_2019 %&gt;% 
  dplyr::mutate(area = sf::st_area(sp_mun_2019)/1e6)
sp_mun_2019_area
```

---

# 6.9 Operações de atributos

## 4. Criação de atributos

```r
plot(sp_mun_2019_area[9], main = "")
```

---

# 6.9 Operações de atributos

## 5. Outros operações: funções do `dplyr` para manejo de feições

```r
dplyr::filter()
dplyr::distinc()
dplyr::slice()
dplyr::n_sample()
```

---

# 6.9 Operações de atributos

## 5. Outros operações: funções do `dplyr` para manejo da tabela de atributos

```r
dplyr::select()
dplyr::pull()
dplyr::rename()
dplyr::mutate()
dplyr::arrange()
dplyr::group_by()
dplyr::summarise()
dplyr::*_join()
```

---

class: inverse, center, middle

# Operações espaciais

---

# 6.10 Operações espaciais

## 1. Subset espacial

---

# 6.10 Operações espaciais

## 2. Relações topológicas

---

# 6.10 Operações espaciais

## 3. Join espacial

---

# 6.10 Operações espaciais

## 4. Join não sobreposta

---

# 6.10 Operações espaciais

## 5. Aggregation espacial

---

# 6.10 Operações espaciais

## 6. Relações de distância

---

# 6.10 Operações espaciais

## Pontos aleatórios

```r
sp_mun_2019_rp &lt;- sf::st_sample(sp_mun_2019 %&gt;% sf::st_transform(crs = 32723), 1e4)
sp_mun_2019_rp
```

---

# 6.10 Operações espaciais

## Pontos aleatórios


---

# 6.10 Operações espaciais

## Quadrículas

```r
sp_mun_2019_grid &lt;- sp_mun_2019 %&gt;% 
  sf::st_transform(crs = 32723) %&gt;% 
  sf::st_make_grid(cellsize = 50000) %&gt;% 
  sf::st_as_sf()
sp_mun_2019_grid
```

---

# 6.10 Operações espaciais

## Quadrículas

```r
# plot
plot(sp_mun_2019_rp, pch = 20, cex = .5, col = "steelblue", main = NA)
plot(sp_mun_2019$geom %&gt;% sf::st_transform(crs = 32723), main = NA, add = TRUE)
plot(sp_mun_2019_grid, col = adjustcolor("white", 0), add = TRUE)
```

---

# 6.10 Operações espaciais

## Contar pontos nas quadrículas

```r
# contagem por célula
sp_mun_2019_grid_count &lt;- sp_mun_2019_grid %&gt;% 
  dplyr::mutate(n = sf::st_intersects(sp_mun_2019_grid, sp_mun_2019_rp) %&gt;% lengths())
sp_mun_2019_grid_count
```

---

# 6.10 Operações espaciais

## Contar pontos nas quadrículas

```r
# map
tm_shape(sp_mun_2019_grid_count) +
  tm_polygons(col = "n") +
tm_shape(sp_mun_2019_rp) +
  tm_dots(size = .01, col = "steelblue", alpha = .75) +
  tm_legend(legend.position = c("left", "bottom"))
```

---

class: inverse, center, middle

# Operações geométricas

---

# 6.11 Operações geométricas

## 1. Simplificação

```r
# simplification
sp_mun_2019_simp &lt;- sf::st_simplify(sp_mun_2019, dTolerance = .05)
sp_mun_2019_simp
```

---

# 6.11 Operações geométricas

## 1. Simplificação


---

# 6.11 Operações geométricas

## 2. Centroides

```r
sp_mun_2019_cent &lt;- sf::st_centroid(sp_mun_2019)
sp_mun_2019_cent
```

---

# 6.11 Operações geométricas

## 2. Centroides

```r
# plot
plot(sp_mun_2019$geom, main = NA)
plot(sp_mun_2019_cent$geom, col = "red", pch = 20, main = NA, add = TRUE)
```

---

# 6.11 Operações geométricas

## 3. Buffer

```r
sp_mun_2019_cent_buf &lt;- sp_mun_2019_cent %&gt;% 
  sf::st_transform(crs = 32723) %&gt;% 
  sf::st_buffer(dist = 1000)
sp_mun_2019_cent_buf
```

---

# 6.11 Operações geométricas

## 3. Buffer


---

# 6.11 Operações geométricas

## 4. Transformações afins


---

# 6.11 Operações geométricas

## 5. Cortes

---

# 6.11 Operações geométricas

## 6. União (Dissolve)

```r
sp_mun_2019_union &lt;- sf::st_union(sp_mun_2019)
sp_mun_2019_union
```

---

# 6.11 Operações geométricas

## 6. União (Dissolve)


---

# 6.11 Operações geométricas

## 7. Transformações de tipo

---

# 6.12 Exportar dados

## Exportar como shapefile

```r
sf::write_sf()
```

---

# 6.12 Exportar dados

## Exportar como geopackage

```r
sf::write_sf()
```

---

class: inverse, middle, center

# Dúvidas?

---

class: clear, middle

## Maurício Vancine

&lt;br&gt;

Contatos:

<i class="fas  fa-envelope " style="color:#0000ee;"></i> [mauricio.vancine@gmail.com]()
&lt;br&gt;
<i class="fab  fa-twitter " style="color:#0000ee;"></i> [@mauriciovancine](https://twitter.com/mauriciovancine)
&lt;br&gt;
<i class="fab  fa-github " style="color:#0000ee;"></i> [mauriciovancine](https://mauriciovancine.netlify.com/)
&lt;br&gt;
<i class="fas  fa-link " style="color:#0000ee;"></i> [mauriciovancine.netlify.com](https://mauriciovancine.netlify.com/)

Slides criados via pacote [xaringan](https://github.com/yihui/xaringan) e tema [Metropolis](https://github.com/pat-s/xaringan-metropolis)
    </textarea>
<style data-target="print-only">@media screen {.remark-slide-container{display:block;}.remark-slide-scaler{box-shadow:none;}}</style>
<script src="https://remarkjs.com/downloads/remark-latest.min.js"></script>
<script>var slideshow = remark.create({
"highlightStyle": "rainbow",
"highlightLines": true,
"countIncrementalSlides": false
});
if (window.HTMLWidgets) slideshow.on('afterShowSlide', function (slide) {
  window.dispatchEvent(new Event('resize'));
});
(function(d) {
  var s = d.createElement("style"), r = d.querySelector(".remark-slide-scaler");
  if (!r) return;
  s.type = "text/css"; s.innerHTML = "@page {size: " + r.style.width + " " + r.style.height +"; }";
  d.head.appendChild(s);
})(document);

(function(d) {
  var el = d.getElementsByClassName("remark-slides-area");
  if (!el) return;
  var slide, slides = slideshow.getSlides(), els = el[0].children;
  for (var i = 1; i < slides.length; i++) {
    slide = slides[i];
    if (slide.properties.continued === "true" || slide.properties.count === "false") {
      els[i - 1].className += ' has-continuation';
    }
  }
  var s = d.createElement("style");
  s.type = "text/css"; s.innerHTML = "@media print { .has-continuation { display: none; } }";
  d.head.appendChild(s);
})(document);
// delete the temporary CSS (for displaying all slides initially) when the user
// starts to view slides
(function() {
  var deleted = false;
  slideshow.on('beforeShowSlide', function(slide) {
    if (deleted) return;
    var sheets = document.styleSheets, node;
    for (var i = 0; i < sheets.length; i++) {
      node = sheets[i].ownerNode;
      if (node.dataset["target"] !== "print-only") continue;
      node.parentNode.removeChild(node);
    }
    deleted = true;
  });
})();
(function() {
  "use strict"
  // Replace <script> tags in slides area to make them executable
  var scripts = document.querySelectorAll(
    '.remark-slides-area .remark-slide-container script'
  );
  if (!scripts.length) return;
  for (var i = 0; i < scripts.length; i++) {
    var s = document.createElement('script');
    var code = document.createTextNode(scripts[i].textContent);
    s.appendChild(code);
    var scriptAttrs = scripts[i].attributes;
    for (var j = 0; j < scriptAttrs.length; j++) {
      s.setAttribute(scriptAttrs[j].name, scriptAttrs[j].value);
    }
    scripts[i].parentElement.replaceChild(s, scripts[i]);
  }
})();
(function() {
  var links = document.getElementsByTagName('a');
  for (var i = 0; i < links.length; i++) {
    if (/^(https?:)?\/\//.test(links[i].getAttribute('href'))) {
      links[i].target = '_blank';
    }
  }
})();
// adds .remark-code-has-line-highlighted class to <pre> parent elements
// of code chunks containing highlighted lines with class .remark-code-line-highlighted
(function(d) {
  const hlines = d.querySelectorAll('.remark-code-line-highlighted');
  const preParents = [];
  const findPreParent = function(line, p = 0) {
    if (p > 1) return null; // traverse up no further than grandparent
    const el = line.parentElement;
    return el.tagName === "PRE" ? el : findPreParent(el, ++p);
  };

  for (let line of hlines) {
    let pre = findPreParent(line);
    if (pre && !preParents.includes(pre)) preParents.push(pre);
  }
  preParents.forEach(p => p.classList.add("remark-code-has-line-highlighted"));
})(document);</script>

<script>
slideshow._releaseMath = function(el) {
  var i, text, code, codes = el.getElementsByTagName('code');
  for (i = 0; i < codes.length;) {
    code = codes[i];
    if (code.parentNode.tagName !== 'PRE' && code.childElementCount === 0) {
      text = code.textContent;
      if (/^\\\((.|\s)+\\\)$/.test(text) || /^\\\[(.|\s)+\\\]$/.test(text) ||
          /^\$\$(.|\s)+\$\$$/.test(text) ||
          /^\\begin\{([^}]+)\}(.|\s)+\\end\{[^}]+\}$/.test(text)) {
        code.outerHTML = code.innerHTML;  // remove <code></code>
        continue;
      }
    }
    i++;
  }
};
slideshow._releaseMath(document);
</script>
<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
(function () {
  var script = document.createElement('script');
  script.type = 'text/javascript';
  script.src  = 'https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML';
  if (location.protocol !== 'file:' && /^https?:/.test(script.src))
    script.src  = script.src.replace(/^https?:/, '');
  document.getElementsByTagName('head')[0].appendChild(script);
})();
</script>
  </body>
</html>
